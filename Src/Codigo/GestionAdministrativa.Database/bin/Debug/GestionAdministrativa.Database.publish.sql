/*
Deployment script for GestionAdministrativa.Database

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "GestionAdministrativa.Database"
:setvar DefaultFilePrefix "GestionAdministrativa.Database"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [master];


GO

IF (DB_ID(N'$(DatabaseName)') IS NOT NULL) 
BEGIN
    ALTER DATABASE [$(DatabaseName)]
    SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
    DROP DATABASE [$(DatabaseName)];
END

GO
PRINT N'Creating $(DatabaseName)...'
GO
CREATE DATABASE [$(DatabaseName)]
    ON 
    PRIMARY(NAME = [$(DatabaseName)], FILENAME = N'$(DefaultDataPath)$(DefaultFilePrefix)_Primary.mdf')
    LOG ON (NAME = [$(DatabaseName)_log], FILENAME = N'$(DefaultLogPath)$(DefaultFilePrefix)_Primary.ldf') COLLATE SQL_Latin1_General_CP1_CI_AS
GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                NUMERIC_ROUNDABORT OFF,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL,
                RECOVERY FULL,
                CURSOR_CLOSE_ON_COMMIT OFF,
                AUTO_CREATE_STATISTICS ON,
                AUTO_SHRINK OFF,
                AUTO_UPDATE_STATISTICS ON,
                RECURSIVE_TRIGGERS OFF 
            WITH ROLLBACK IMMEDIATE;
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CLOSE OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET READ_COMMITTED_SNAPSHOT OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_UPDATE_STATISTICS_ASYNC OFF,
                PAGE_VERIFY NONE,
                DATE_CORRELATION_OPTIMIZATION OFF,
                DISABLE_BROKER,
                PARAMETERIZATION SIMPLE,
                SUPPLEMENTAL_LOGGING OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET TRUSTWORTHY OFF,
        DB_CHAINING OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET HONOR_BROKER_PRIORITY OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET FILESTREAM(NON_TRANSACTED_ACCESS = OFF),
                CONTAINMENT = NONE 
            WITH ROLLBACK IMMEDIATE;
    END


GO
USE [$(DatabaseName)];


GO
IF fulltextserviceproperty(N'IsFulltextInstalled') = 1
    EXECUTE sp_fulltext_database 'enable';


GO
PRINT N'Creating [dbo].[Cajas]...';


GO
CREATE TABLE [dbo].[Cajas] (
    [Id]                     UNIQUEIDENTIFIER NOT NULL,
    [SucursalId]             INT              NOT NULL,
    [OperadorId]             UNIQUEIDENTIFIER NULL,
    [Fecha]                  DATETIME         NOT NULL,
    [FCierre]                DATETIME         NULL,
    [Inicio]                 REAL             NULL,
    [Ingresos]               REAL             NULL,
    [Egresos]                REAL             NULL,
    [Saldo]                  REAL             NULL,
    [Cheques]                REAL             NULL,
    [Bonos]                  REAL             NULL,
    [PcAlta]                 NVARCHAR (20)    NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_Cajas] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[CajasMovimientos]...';


GO
CREATE TABLE [dbo].[CajasMovimientos] (
    [Id]                     UNIQUEIDENTIFIER NOT NULL,
    [CajaId]                 UNIQUEIDENTIFIER NOT NULL,
    [TipoMovimientoCajaId]   INT              NULL,
    [TipoComprobante]        INT              NULL,
    [ComprobanteId]          UNIQUEIDENTIFIER NULL,
    [Senia]                  MONEY            NULL,
    [Recargo]                MONEY            NULL,
    [Importe]                MONEY            NULL,
    [ImpFac]                 MONEY            NULL,
    [Efectivo]               MONEY            NULL,
    [Tarjeta]                MONEY            NULL,
    [Cheque]                 MONEY            NULL,
    [Bono]                   MONEY            NULL,
    [fpcBono]                NVARCHAR (20)    NULL,
    [Deposito]               MONEY            NULL,
    [CajaIdAnt]              NCHAR (20)       NULL,
    [CompIdAnt]              NCHAR (20)       NULL,
    [CompLcnAnt]             NCHAR (20)       NULL,
    [FacturaReservadas]      INT              NULL,
    [PcAlta]                 NVARCHAR (20)    NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    [Transferencia]          MONEY            NULL,
    CONSTRAINT [PK_CajasMovimientos] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[CategoriasOperadores]...';


GO
CREATE TABLE [dbo].[CategoriasOperadores] (
    [Id]                     INT              IDENTITY (1, 1) NOT NULL,
    [Nombre]                 VARCHAR (50)     NULL,
    [Abreviatura]            NVARCHAR (10)    NULL,
    [Descripcion]            NVARCHAR (50)    NULL,
    [Prioridad]              INT              NULL,
    [FechaAlta]              DATETIME         NULL,
    [SucursalAltaId]         INT              NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [FechaModificacion]      DATETIME         NULL,
    [SucursalModificacionId] INT              NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    CONSTRAINT [PK_CategoriasOperadores] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Clientes]...';


GO
CREATE TABLE [dbo].[Clientes] (
    [Id]                     UNIQUEIDENTIFIER NOT NULL,
    [SucursalId]             INT              NULL,
    [Cuenta]                 INT              NULL,
    [Denominacion]           NVARCHAR (80)    NULL,
    [Domicilio]              NCHAR (100)      NULL,
    [DomicilioDoc]           NCHAR (100)      NULL,
    [Telefono]               NCHAR (40)       NULL,
    [Celular]                NCHAR (15)       NULL,
    [Fax]                    NCHAR (15)       NULL,
    [Cuit]                   NVARCHAR (11)    NULL,
    [Mail]                   NCHAR (40)       NULL,
    [VendedorId]             INT              NULL,
    [ProvinciaId]            INT              NULL,
    [LocalidadId]            INT              NULL,
    [CondicionVentaId]       INT              NULL,
    [FechaNacimiento]        DATETIME         NULL,
    [PagoLocal]              BIT              NULL,
    [ZonaId]                 INT              NULL,
    [TipoDocumentoId]        INT              NULL,
    [CondicionIvaId]         INT              NULL,
    [Contacto]               VARCHAR (50)     NULL,
    [ProfesionId]            INT              NULL,
    [EspecialidadId]         INT              NULL,
    [EstadoClienteId]        INT              NULL,
    [AceptaConsig]           BIT              NULL,
    [Imagen]                 NVARCHAR (100)   NULL,
    [Comentarios]            NTEXT            NULL,
    [Temp]                   BIT              NULL,
    [Recargo]                REAL             NULL,
    [Activo]                 BIT              NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    [MandarMail]             BIT              NULL,
    [Llamar]                 BIT              NULL,
    CONSTRAINT [PK_s00Clientes_1] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY];


GO
PRINT N'Creating [dbo].[ClientesCuentasCorriente]...';


GO
CREATE TABLE [dbo].[ClientesCuentasCorriente] (
    [Id]                     UNIQUEIDENTIFIER NOT NULL,
    [VentaId]                UNIQUEIDENTIFIER NOT NULL,
    [ClienteId]              UNIQUEIDENTIFIER NOT NULL,
    [Cuota]                  TINYINT          NOT NULL,
    [Fecha]                  DATETIME         NULL,
    [FechaVencimiento]       DATETIME         NULL,
    [FechaUltimoPago]        DATETIME         NULL,
    [Importe]                REAL             NULL,
    [Pagado]                 REAL             NULL,
    [FechaGeneracion]        DATETIME         NULL,
    [Observaciones]          VARCHAR (255)    NULL,
    [FechaAlta]              DATETIME         NOT NULL,
    [SucursalAltaId]         INT              NOT NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [FechaModificacion]      DATETIME         NULL,
    [SucursalModificacionId] INT              NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    CONSTRAINT [PK_ClientesCuentasCorriente] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Cobradores]...';


GO
CREATE TABLE [dbo].[Cobradores] (
    [Id]                     INT              IDENTITY (1, 1) NOT NULL,
    [Nombre]                 NVARCHAR (50)    NOT NULL,
    [Abreviatura]            NVARCHAR (10)    NULL,
    [Domicilio]              NCHAR (100)      NULL,
    [Telefono]               NCHAR (40)       NULL,
    [Celular]                NCHAR (15)       NULL,
    [Cuit]                   NVARCHAR (11)    NULL,
    [Mail]                   NCHAR (40)       NULL,
    [ProvinciaId]            INT              NULL,
    [LocalidadId]            INT              NULL,
    [TipoDocumentoId]        INT              NULL,
    [Activo]                 BIT              NOT NULL,
    [FechaAlta]              DATETIME         NOT NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NOT NULL,
    [SucursalAltaId]         INT              NOT NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_Cobradores] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[CondicionesIVA]...';


GO
CREATE TABLE [dbo].[CondicionesIVA] (
    [Id]                     INT              NOT NULL,
    [Nombre]                 NVARCHAR (50)    NOT NULL,
    [Abreviatura]            NVARCHAR (10)    NULL,
    [Descripcion]            NVARCHAR (500)   NULL,
    [Prioridad]              INT              NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_CondicionesIVA] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[CondicionesVenta]...';


GO
CREATE TABLE [dbo].[CondicionesVenta] (
    [Id]                     INT              NOT NULL,
    [Nombre]                 NVARCHAR (50)    NOT NULL,
    [Abreviatura]            NVARCHAR (10)    NULL,
    [Descripcion]            NVARCHAR (50)    NULL,
    [Prioridad]              INT              NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_CondicionesVenta] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Especialidades]...';


GO
CREATE TABLE [dbo].[Especialidades] (
    [Id]                     INT              IDENTITY (1, 1) NOT NULL,
    [Nombre]                 VARCHAR (50)     NULL,
    [ProfesionId]            INT              NOT NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_EspecialidadesClientes] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[EstadosCliente]...';


GO
CREATE TABLE [dbo].[EstadosCliente] (
    [Id]                     INT              NOT NULL,
    [Nombre]                 VARCHAR (50)     NOT NULL,
    [Abreviatura]            NVARCHAR (10)    NULL,
    [Descripcion]            NVARCHAR (50)    NULL,
    [Prioridad]              INT              NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_EstadosClientes] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[EstadosVenta]...';


GO
CREATE TABLE [dbo].[EstadosVenta] (
    [Id]                     INT              NOT NULL,
    [Nombre]                 VARCHAR (50)     NOT NULL,
    [Abreviatura]            NVARCHAR (10)    NULL,
    [Decripcion]             NVARCHAR (50)    NULL,
    [Prioridad]              INT              NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NOT NULL,
    [SucursalAltaId]         INT              NOT NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_EstadosVentas] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Localidades]...';


GO
CREATE TABLE [dbo].[Localidades] (
    [Id]                     INT              NOT NULL,
    [Nombre]                 NVARCHAR (40)    NULL,
    [CP]                     NVARCHAR (10)    NULL,
    [ProvinciaId]            INT              NOT NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_Localidades_1] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Operadores]...';


GO
CREATE TABLE [dbo].[Operadores] (
    [Id]                     UNIQUEIDENTIFIER NOT NULL,
    [Usuario]                NVARCHAR (10)    NOT NULL,
    [Clave]                  NVARCHAR (64)    NULL,
    [VigenteDesde]           DATETIME         NULL,
    [VigenteHasta]           DATETIME         NULL,
    [PersonalId]             UNIQUEIDENTIFIER NULL,
    [FechaAlta]              DATETIME         NULL,
    [SucursalAltaId]         INT              NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    [Habilitado]             BIT              NOT NULL,
    CONSTRAINT [PK_Operadores_1] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Personal]...';


GO
CREATE TABLE [dbo].[Personal] (
    [Id]                     UNIQUEIDENTIFIER NOT NULL,
    [ContactoId]             UNIQUEIDENTIFIER NULL,
    [Nombre]                 NVARCHAR (50)    NULL,
    [Cuit]                   NVARCHAR (50)    NULL,
    [Domicilio]              NVARCHAR (100)   NULL,
    [ProvinciaId]            INT              NULL,
    [LocalidadId]            INT              NULL,
    [CategoriaId]            INT              NULL,
    [SucursalId]             INT              NULL,
    [TipoLiquidacionId]      INT              NULL,
    [Telefono]               NVARCHAR (50)    NULL,
    [Celular]                NVARCHAR (50)    NULL,
    [Fax]                    NVARCHAR (50)    NULL,
    [FechaAlta]              DATETIME         NULL,
    [HoraDesdeM]             CHAR (4)         NULL,
    [HoraHastaM]             CHAR (4)         NULL,
    [HoraDesdeT]             CHAR (4)         NULL,
    [HoraHastaT]             CHAR (4)         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_Personal] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Profesiones]...';


GO
CREATE TABLE [dbo].[Profesiones] (
    [Id]                     INT              NOT NULL,
    [Nombre]                 NVARCHAR (50)    NOT NULL,
    [Abreviatura]            NVARCHAR (10)    NULL,
    [Descripcion]            NVARCHAR (50)    NULL,
    [Prioridad]              INT              NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_Profesiones] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Provincias]...';


GO
CREATE TABLE [dbo].[Provincias] (
    [Id]                     INT              NOT NULL,
    [Nombre]                 VARCHAR (50)     NULL,
    [NombreCorto]            NCHAR (10)       NULL,
    [PaisId]                 INT              NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_Provincias_1] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Sucursales]...';


GO
CREATE TABLE [dbo].[Sucursales] (
    [Id]                        INT              NOT NULL,
    [Nombre]                    NVARCHAR (30)    NULL,
    [NombreCorto]               NVARCHAR (10)    NULL,
    [ProvinciaId]               INT              NULL,
    [LocalidadId]               INT              NULL,
    [Direccion]                 NVARCHAR (50)    NULL,
    [TelPart]                   NVARCHAR (20)    NULL,
    [TelCel]                    NVARCHAR (20)    NULL,
    [Fax]                       NVARCHAR (20)    NULL,
    [Responsable]               NVARCHAR (30)    NULL,
    [OperadorModificacionId]    UNIQUEIDENTIFIER NULL,
    [FechaAlta]                 DATETIME         NULL,
    [SucursalAltaId]            INT              NULL,
    [OperadorAltaId]            UNIQUEIDENTIFIER NULL,
    [FechaModificacion]         DATETIME         NULL,
    [SucursalModificacionId]    INT              NULL,
    [MaximoImporteVenta]        MONEY            NOT NULL,
    [MaximoPorcentajeDescuento] DECIMAL (18, 2)  NOT NULL,
    [MaximoNroLineasPorVenta]   INT              NOT NULL,
    [SucursalNumero]            INT              NULL,
    CONSTRAINT [PK_s00Sucursales] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[TiposComprobantes]...';


GO
CREATE TABLE [dbo].[TiposComprobantes] (
    [Id]                     INT              NOT NULL,
    [Nombre]                 VARCHAR (50)     NOT NULL,
    [Abreviatura]            NVARCHAR (10)    NULL,
    [Descripcion]            NVARCHAR (50)    NULL,
    [Prioridad]              INT              NULL,
    [Comprobante]            NCHAR (10)       NULL,
    [Concepto]               NVARCHAR (50)    NULL,
    [FechaAlta]              DATETIME         NULL,
    [SucursalAltaId]         INT              NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [FechaModificacion]      DATETIME         NULL,
    [SucursalModificacionId] INT              NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    CONSTRAINT [PK_TiposComprobantes] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[TiposDocumentosIdentidad]...';


GO
CREATE TABLE [dbo].[TiposDocumentosIdentidad] (
    [Id]                     INT              NOT NULL,
    [Nombre]                 NVARCHAR (50)    NOT NULL,
    [Abreviatura]            NVARCHAR (10)    NULL,
    [Descripcion]            NVARCHAR (50)    NULL,
    [Prioridad]              INT              NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_TiposDocumentosIdentidad] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[TiposMovimientosCajas]...';


GO
CREATE TABLE [dbo].[TiposMovimientosCajas] (
    [Id]                     INT              NOT NULL,
    [Nombre]                 VARCHAR (50)     NOT NULL,
    [Abreviatura]            NVARCHAR (15)    NULL,
    [TipoMovimiento]         INT              NULL,
    [CodTipoAnt]             INT              NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_TiposMovimientosCajas] PRIMARY KEY CLUSTERED ([Id] ASC) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Vendedores]...';


GO
CREATE TABLE [dbo].[Vendedores] (
    [Id]              INT              NOT NULL,
    [Nombre]          VARCHAR (50)     NOT NULL,
    [Abreviatura]     NVARCHAR (10)    NULL,
    [FechaGeneracion] DATETIME         NULL,
    [OperadorId]      UNIQUEIDENTIFIER NULL,
    CONSTRAINT [PK_Vendedores] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Ventas]...';


GO
CREATE TABLE [dbo].[Ventas] (
    [Id]                     UNIQUEIDENTIFIER NOT NULL,
    [LCN]                    VARCHAR (15)     NOT NULL,
    [ComprobanteId]          INT              NOT NULL,
    [ClienteId]              UNIQUEIDENTIFIER NOT NULL,
    [LetraComprobante]       CHAR (1)         NOT NULL,
    [PuntoVenta]             INT              NOT NULL,
    [NumeroComprobante]      INT              NOT NULL,
    [FechaComprobante]       DATETIME         NULL,
    [FechaVencimiento]       DATETIME         NULL,
    [CondicionVentaId]       INT              NULL,
    [Concepto]               NVARCHAR (50)    NULL,
    [ImporteNeto]            MONEY            NOT NULL,
    [ImporteIva]             MONEY            NOT NULL,
    [ImporteSena]            MONEY            NULL,
    [FechaUltimoPago]        DATETIME         NULL,
    [TotalPagado]            MONEY            NULL,
    [EstadoVentaId]          INT              NOT NULL,
    [FechaAlta]              DATETIME         NULL,
    [SucursalAltaId]         INT              NOT NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NOT NULL,
    [FechaModificacion]      DATETIME         NULL,
    [SucursalModificacionId] INT              NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [OperadorAutoriza]       UNIQUEIDENTIFIER NULL,
    [ValidacionUsuario]      NVARCHAR (50)    NULL,
    CONSTRAINT [PK_Ventas] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Zonas]...';


GO
CREATE TABLE [dbo].[Zonas] (
    [Id]                     INT              NOT NULL,
    [Nombre]                 VARCHAR (50)     NOT NULL,
    [Abreviatura]            NVARCHAR (10)    NULL,
    [FechaAlta]              DATETIME         NULL,
    [OperadorAltaId]         UNIQUEIDENTIFIER NULL,
    [SucursalAltaId]         INT              NULL,
    [FechaModificacion]      DATETIME         NULL,
    [OperadorModificacionId] UNIQUEIDENTIFIER NULL,
    [SucursalModificacionId] INT              NULL,
    CONSTRAINT [PK_Zonas] PRIMARY KEY CLUSTERED ([Id] ASC) WITH (FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[DF_Clientes_Id]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [DF_Clientes_Id] DEFAULT (newid()) FOR [Id];


GO
PRINT N'Creating <unnamed>...';


GO
ALTER TABLE [dbo].[Operadores]
    ADD DEFAULT ((1)) FOR [Habilitado];


GO
PRINT N'Creating <unnamed>...';


GO
ALTER TABLE [dbo].[Sucursales]
    ADD DEFAULT ((1000)) FOR [MaximoImporteVenta];


GO
PRINT N'Creating <unnamed>...';


GO
ALTER TABLE [dbo].[Sucursales]
    ADD DEFAULT ((0)) FOR [MaximoPorcentajeDescuento];


GO
PRINT N'Creating <unnamed>...';


GO
ALTER TABLE [dbo].[Sucursales]
    ADD DEFAULT ((10)) FOR [MaximoNroLineasPorVenta];


GO
PRINT N'Creating [dbo].[FK_Cajas_Operador]...';


GO
ALTER TABLE [dbo].[Cajas]
    ADD CONSTRAINT [FK_Cajas_Operador] FOREIGN KEY ([OperadorId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cajas_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Cajas]
    ADD CONSTRAINT [FK_Cajas_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cajas_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Cajas]
    ADD CONSTRAINT [FK_Cajas_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cajas_Sucursal]...';


GO
ALTER TABLE [dbo].[Cajas]
    ADD CONSTRAINT [FK_Cajas_Sucursal] FOREIGN KEY ([SucursalId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cajas_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Cajas]
    ADD CONSTRAINT [FK_Cajas_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cajas_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Cajas]
    ADD CONSTRAINT [FK_Cajas_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CajasMovimientos_OperadorAlta]...';


GO
ALTER TABLE [dbo].[CajasMovimientos]
    ADD CONSTRAINT [FK_CajasMovimientos_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CajasMovimientos_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[CajasMovimientos]
    ADD CONSTRAINT [FK_CajasMovimientos_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CajasMovimientos_SucursalAlta]...';


GO
ALTER TABLE [dbo].[CajasMovimientos]
    ADD CONSTRAINT [FK_CajasMovimientos_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CajasMovimientos_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[CajasMovimientos]
    ADD CONSTRAINT [FK_CajasMovimientos_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CajasMovimientos_TipoComprobante]...';


GO
ALTER TABLE [dbo].[CajasMovimientos]
    ADD CONSTRAINT [FK_CajasMovimientos_TipoComprobante] FOREIGN KEY ([TipoComprobante]) REFERENCES [dbo].[TiposComprobantes] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CajasMovimientos_TipoMovimientoCaja]...';


GO
ALTER TABLE [dbo].[CajasMovimientos]
    ADD CONSTRAINT [FK_CajasMovimientos_TipoMovimientoCaja] FOREIGN KEY ([TipoMovimientoCajaId]) REFERENCES [dbo].[TiposMovimientosCajas] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CategoriasOperadores_OperadorAlta]...';


GO
ALTER TABLE [dbo].[CategoriasOperadores]
    ADD CONSTRAINT [FK_CategoriasOperadores_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CategoriasOperadores_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[CategoriasOperadores]
    ADD CONSTRAINT [FK_CategoriasOperadores_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CategoriasOperadores_SucursalAlta]...';


GO
ALTER TABLE [dbo].[CategoriasOperadores]
    ADD CONSTRAINT [FK_CategoriasOperadores_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CategoriasOperadores_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[CategoriasOperadores]
    ADD CONSTRAINT [FK_CategoriasOperadores_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_CondicionIva]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_CondicionIva] FOREIGN KEY ([CondicionIvaId]) REFERENCES [dbo].[CondicionesIVA] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_CondicionVenta]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_CondicionVenta] FOREIGN KEY ([CondicionVentaId]) REFERENCES [dbo].[CondicionesVenta] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_Especialidad]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_Especialidad] FOREIGN KEY ([EspecialidadId]) REFERENCES [dbo].[Especialidades] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_EstadoClienteId]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_EstadoClienteId] FOREIGN KEY ([EstadoClienteId]) REFERENCES [dbo].[EstadosCliente] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_Localidad]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_Localidad] FOREIGN KEY ([LocalidadId]) REFERENCES [dbo].[Localidades] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_Profesion]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_Profesion] FOREIGN KEY ([ProfesionId]) REFERENCES [dbo].[Profesiones] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_Provincia]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_Provincia] FOREIGN KEY ([ProvinciaId]) REFERENCES [dbo].[Provincias] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_Sucursales]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_Sucursales] FOREIGN KEY ([SucursalId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_TipoDocumento]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_TipoDocumento] FOREIGN KEY ([TipoDocumentoId]) REFERENCES [dbo].[TiposDocumentosIdentidad] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_Vendedores]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_Vendedores] FOREIGN KEY ([VendedorId]) REFERENCES [dbo].[Vendedores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Clientes_Zona]...';


GO
ALTER TABLE [dbo].[Clientes]
    ADD CONSTRAINT [FK_Clientes_Zona] FOREIGN KEY ([ZonaId]) REFERENCES [dbo].[Zonas] ([Id]);


GO
PRINT N'Creating [dbo].[FK_ClientesCuentasCorriente_Clientes]...';


GO
ALTER TABLE [dbo].[ClientesCuentasCorriente]
    ADD CONSTRAINT [FK_ClientesCuentasCorriente_Clientes] FOREIGN KEY ([ClienteId]) REFERENCES [dbo].[Clientes] ([Id]);


GO
PRINT N'Creating [dbo].[FK_ClientesCuentasCorriente_SucursalAltaId]...';


GO
ALTER TABLE [dbo].[ClientesCuentasCorriente]
    ADD CONSTRAINT [FK_ClientesCuentasCorriente_SucursalAltaId] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_ClientesCuentasCorriente_OperadorAltaId]...';


GO
ALTER TABLE [dbo].[ClientesCuentasCorriente]
    ADD CONSTRAINT [FK_ClientesCuentasCorriente_OperadorAltaId] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_ClientesCuentasCorriente_SucursalModificacionId]...';


GO
ALTER TABLE [dbo].[ClientesCuentasCorriente]
    ADD CONSTRAINT [FK_ClientesCuentasCorriente_SucursalModificacionId] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_ClientesCuentasCorriente_OperadorModificacionId]...';


GO
ALTER TABLE [dbo].[ClientesCuentasCorriente]
    ADD CONSTRAINT [FK_ClientesCuentasCorriente_OperadorModificacionId] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_ClientesCuentasCorriente_VentasId]...';


GO
ALTER TABLE [dbo].[ClientesCuentasCorriente]
    ADD CONSTRAINT [FK_ClientesCuentasCorriente_VentasId] FOREIGN KEY ([VentaId]) REFERENCES [dbo].[Ventas] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cobradores_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Cobradores]
    ADD CONSTRAINT [FK_Cobradores_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cobradores_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Cobradores]
    ADD CONSTRAINT [FK_Cobradores_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cobradores_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Cobradores]
    ADD CONSTRAINT [FK_Cobradores_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cobradores_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Cobradores]
    ADD CONSTRAINT [FK_Cobradores_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cobradores_TipoDocumento]...';


GO
ALTER TABLE [dbo].[Cobradores]
    ADD CONSTRAINT [FK_Cobradores_TipoDocumento] FOREIGN KEY ([TipoDocumentoId]) REFERENCES [dbo].[TiposDocumentosIdentidad] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cobradores_Provincia]...';


GO
ALTER TABLE [dbo].[Cobradores]
    ADD CONSTRAINT [FK_Cobradores_Provincia] FOREIGN KEY ([ProvinciaId]) REFERENCES [dbo].[Provincias] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Cobradores_Localidad]...';


GO
ALTER TABLE [dbo].[Cobradores]
    ADD CONSTRAINT [FK_Cobradores_Localidad] FOREIGN KEY ([LocalidadId]) REFERENCES [dbo].[Localidades] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CondicionesIVA_OperadorAlta]...';


GO
ALTER TABLE [dbo].[CondicionesIVA]
    ADD CONSTRAINT [FK_CondicionesIVA_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CondicionesIVA_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[CondicionesIVA]
    ADD CONSTRAINT [FK_CondicionesIVA_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CondicionesIVA_SucursalAlta]...';


GO
ALTER TABLE [dbo].[CondicionesIVA]
    ADD CONSTRAINT [FK_CondicionesIVA_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CondicionesIVA_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[CondicionesIVA]
    ADD CONSTRAINT [FK_CondicionesIVA_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Especialidades_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Especialidades]
    ADD CONSTRAINT [FK_Especialidades_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Especialidades_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Especialidades]
    ADD CONSTRAINT [FK_Especialidades_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Especialidades_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Especialidades]
    ADD CONSTRAINT [FK_Especialidades_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Especialidades_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Especialidades]
    ADD CONSTRAINT [FK_Especialidades_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Especialidades_Profesion]...';


GO
ALTER TABLE [dbo].[Especialidades]
    ADD CONSTRAINT [FK_Especialidades_Profesion] FOREIGN KEY ([ProfesionId]) REFERENCES [dbo].[Profesiones] ([Id]);


GO
PRINT N'Creating [dbo].[FK_EstadosVenta_OperadorAltaId]...';


GO
ALTER TABLE [dbo].[EstadosVenta]
    ADD CONSTRAINT [FK_EstadosVenta_OperadorAltaId] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_EstadosVenta_SucursalAltaId]...';


GO
ALTER TABLE [dbo].[EstadosVenta]
    ADD CONSTRAINT [FK_EstadosVenta_SucursalAltaId] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_EstadosVenta_OperadorModificacionId]...';


GO
ALTER TABLE [dbo].[EstadosVenta]
    ADD CONSTRAINT [FK_EstadosVenta_OperadorModificacionId] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_EstadosVenta_SucursalModificacionId]...';


GO
ALTER TABLE [dbo].[EstadosVenta]
    ADD CONSTRAINT [FK_EstadosVenta_SucursalModificacionId] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Localidades_Provincia]...';


GO
ALTER TABLE [dbo].[Localidades]
    ADD CONSTRAINT [FK_Localidades_Provincia] FOREIGN KEY ([ProvinciaId]) REFERENCES [dbo].[Provincias] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Localidades_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Localidades]
    ADD CONSTRAINT [FK_Localidades_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Localidades_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Localidades]
    ADD CONSTRAINT [FK_Localidades_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Localidades_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Localidades]
    ADD CONSTRAINT [FK_Localidades_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Localidades_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Localidades]
    ADD CONSTRAINT [FK_Localidades_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Operadores_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Operadores]
    ADD CONSTRAINT [FK_Operadores_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Operadores_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Operadores]
    ADD CONSTRAINT [FK_Operadores_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Operadores_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Operadores]
    ADD CONSTRAINT [FK_Operadores_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Operadores_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Operadores]
    ADD CONSTRAINT [FK_Operadores_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Operadores_Personal]...';


GO
ALTER TABLE [dbo].[Operadores]
    ADD CONSTRAINT [FK_Operadores_Personal] FOREIGN KEY ([PersonalId]) REFERENCES [dbo].[Personal] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Personal_Provincia]...';


GO
ALTER TABLE [dbo].[Personal]
    ADD CONSTRAINT [FK_Personal_Provincia] FOREIGN KEY ([ProvinciaId]) REFERENCES [dbo].[Provincias] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Personal_Localidad]...';


GO
ALTER TABLE [dbo].[Personal]
    ADD CONSTRAINT [FK_Personal_Localidad] FOREIGN KEY ([LocalidadId]) REFERENCES [dbo].[Localidades] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Personal_Sucursal]...';


GO
ALTER TABLE [dbo].[Personal]
    ADD CONSTRAINT [FK_Personal_Sucursal] FOREIGN KEY ([SucursalId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Personal_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Personal]
    ADD CONSTRAINT [FK_Personal_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Personal_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Personal]
    ADD CONSTRAINT [FK_Personal_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Personal_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Personal]
    ADD CONSTRAINT [FK_Personal_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Personal_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Personal]
    ADD CONSTRAINT [FK_Personal_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Personal_CategoriasOperadores]...';


GO
ALTER TABLE [dbo].[Personal]
    ADD CONSTRAINT [FK_Personal_CategoriasOperadores] FOREIGN KEY ([CategoriaId]) REFERENCES [dbo].[CategoriasOperadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Profesiones_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Profesiones]
    ADD CONSTRAINT [FK_Profesiones_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Profesiones_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Profesiones]
    ADD CONSTRAINT [FK_Profesiones_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Profesiones_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Profesiones]
    ADD CONSTRAINT [FK_Profesiones_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Profesiones_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Profesiones]
    ADD CONSTRAINT [FK_Profesiones_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Provincias_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Provincias]
    ADD CONSTRAINT [FK_Provincias_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Provincias_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Provincias]
    ADD CONSTRAINT [FK_Provincias_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Provincias_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Provincias]
    ADD CONSTRAINT [FK_Provincias_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Provincias_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Provincias]
    ADD CONSTRAINT [FK_Provincias_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Sucursales_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Sucursales]
    ADD CONSTRAINT [FK_Sucursales_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Sucursales_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Sucursales]
    ADD CONSTRAINT [FK_Sucursales_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Sucursales_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Sucursales]
    ADD CONSTRAINT [FK_Sucursales_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Sucursales_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Sucursales]
    ADD CONSTRAINT [FK_Sucursales_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Sucursales_Localidades]...';


GO
ALTER TABLE [dbo].[Sucursales]
    ADD CONSTRAINT [FK_Sucursales_Localidades] FOREIGN KEY ([LocalidadId]) REFERENCES [dbo].[Localidades] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Sucursales_Provincias]...';


GO
ALTER TABLE [dbo].[Sucursales]
    ADD CONSTRAINT [FK_Sucursales_Provincias] FOREIGN KEY ([ProvinciaId]) REFERENCES [dbo].[Provincias] ([Id]);


GO
PRINT N'Creating [dbo].[FK_TiposComprobantes_OperadorAlta]...';


GO
ALTER TABLE [dbo].[TiposComprobantes]
    ADD CONSTRAINT [FK_TiposComprobantes_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_TiposComprobantes_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[TiposComprobantes]
    ADD CONSTRAINT [FK_TiposComprobantes_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_TiposComprobantes_SucursalesAlta]...';


GO
ALTER TABLE [dbo].[TiposComprobantes]
    ADD CONSTRAINT [FK_TiposComprobantes_SucursalesAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_TiposComprobantes_SucursalesModificacion]...';


GO
ALTER TABLE [dbo].[TiposComprobantes]
    ADD CONSTRAINT [FK_TiposComprobantes_SucursalesModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_TiposDocumentosIdentidad_OperadorAlta]...';


GO
ALTER TABLE [dbo].[TiposDocumentosIdentidad]
    ADD CONSTRAINT [FK_TiposDocumentosIdentidad_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_TiposDocumentosIdentidad_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[TiposDocumentosIdentidad]
    ADD CONSTRAINT [FK_TiposDocumentosIdentidad_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_TiposDocumentosIdentidad_SucursalAlta]...';


GO
ALTER TABLE [dbo].[TiposDocumentosIdentidad]
    ADD CONSTRAINT [FK_TiposDocumentosIdentidad_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_TiposDocumentosIdentidad_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[TiposDocumentosIdentidad]
    ADD CONSTRAINT [FK_TiposDocumentosIdentidad_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Vendedores_Operador]...';


GO
ALTER TABLE [dbo].[Vendedores]
    ADD CONSTRAINT [FK_Vendedores_Operador] FOREIGN KEY ([OperadorId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Ventas_Cliente]...';


GO
ALTER TABLE [dbo].[Ventas]
    ADD CONSTRAINT [FK_Ventas_Cliente] FOREIGN KEY ([ClienteId]) REFERENCES [dbo].[Clientes] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Ventas_Comprobante]...';


GO
ALTER TABLE [dbo].[Ventas]
    ADD CONSTRAINT [FK_Ventas_Comprobante] FOREIGN KEY ([ComprobanteId]) REFERENCES [dbo].[TiposComprobantes] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Ventas_CondicionVenta]...';


GO
ALTER TABLE [dbo].[Ventas]
    ADD CONSTRAINT [FK_Ventas_CondicionVenta] FOREIGN KEY ([CondicionVentaId]) REFERENCES [dbo].[CondicionesVenta] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Ventas_EstadoVenta]...';


GO
ALTER TABLE [dbo].[Ventas]
    ADD CONSTRAINT [FK_Ventas_EstadoVenta] FOREIGN KEY ([EstadoVentaId]) REFERENCES [dbo].[EstadosVenta] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Ventas_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Ventas]
    ADD CONSTRAINT [FK_Ventas_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Ventas_OperadorAutoriza]...';


GO
ALTER TABLE [dbo].[Ventas]
    ADD CONSTRAINT [FK_Ventas_OperadorAutoriza] FOREIGN KEY ([OperadorAutoriza]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Ventas_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Ventas]
    ADD CONSTRAINT [FK_Ventas_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Ventas_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Ventas]
    ADD CONSTRAINT [FK_Ventas_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Ventas_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Ventas]
    ADD CONSTRAINT [FK_Ventas_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Zonas_OperadorAlta]...';


GO
ALTER TABLE [dbo].[Zonas]
    ADD CONSTRAINT [FK_Zonas_OperadorAlta] FOREIGN KEY ([OperadorAltaId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Zonas_OperadorModificacion]...';


GO
ALTER TABLE [dbo].[Zonas]
    ADD CONSTRAINT [FK_Zonas_OperadorModificacion] FOREIGN KEY ([OperadorModificacionId]) REFERENCES [dbo].[Operadores] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Zonas_SucursalAlta]...';


GO
ALTER TABLE [dbo].[Zonas]
    ADD CONSTRAINT [FK_Zonas_SucursalAlta] FOREIGN KEY ([SucursalAltaId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Zonas_SucursalModificacion]...';


GO
ALTER TABLE [dbo].[Zonas]
    ADD CONSTRAINT [FK_Zonas_SucursalModificacion] FOREIGN KEY ([SucursalModificacionId]) REFERENCES [dbo].[Sucursales] ([Id]);


GO
PRINT N'Creating [dbo].[ComprobantesByVentaId]...';


GO
CREATE PROCEDURE [dbo].[ComprobantesByVentaId]
	@ventaId uniqueidentifier
	
AS
	SELECT C.Cuenta, C.Denominacion, C.Domicilio, C.Telefono, V.Concepto , CM.Importe AS Anticipo,
	COUNT(CCC.Id) AS Cuotas, ccc.Importe as ValorCuota, ccc.Cuota as Cuota, P.Nombre AS Vendedor
	FROM Ventas V
	INNER JOIN ClientesCuentasCorriente CCC
	ON CCC.VentaId= V.Id
	INNER JOIN Clientes C
	ON C.Id = V.ClienteId
	INNER JOIN CajasMovimientos CM
	ON CM.ComprobanteId=V.Id
	INNER JOIN Operadores O
	ON O.Id= V.OperadorAltaId
	INNER JOIN Personal P
	ON P.Id= O.PersonalId
	WHERE V.id= @ventaId 
	GROUP BY C.Cuenta, C.Denominacion, C.Denominacion, C.Domicilio, C.Telefono, V.Concepto, CM.Importe, CCC.Importe,
	CCC.Cuota, P.Nombre
	ORDER BY CCC.Cuota
--RETURN 0
GO
PRINT N'Creating [dbo].[TiposMovimientosCajas].[CodTipoAnt].[MS_Description]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_Description', @value = N'Tipo de movimiento (Egreso / Ingreso)', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'TABLE', @level1name = N'TiposMovimientosCajas', @level2type = N'COLUMN', @level2name = N'CodTipoAnt';


GO
-- Refactoring step to update target server with deployed transaction logs

IF OBJECT_ID(N'dbo.__RefactorLog') IS NULL
BEGIN
    CREATE TABLE [dbo].[__RefactorLog] (OperationKey UNIQUEIDENTIFIER NOT NULL PRIMARY KEY)
    EXEC sp_addextendedproperty N'microsoft_database_tools_support', N'refactoring log', N'schema', N'dbo', N'table', N'__RefactorLog'
END
GO
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '4871ef40-9460-448a-8fb2-08cfd235578b')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('4871ef40-9460-448a-8fb2-08cfd235578b')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '2b1cd19b-8325-4303-a763-303b3f8539fa')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('2b1cd19b-8325-4303-a763-303b3f8539fa')

GO

GO
DECLARE @VarDecimalSupported AS BIT;

SELECT @VarDecimalSupported = 0;

IF ((ServerProperty(N'EngineEdition') = 3)
    AND (((@@microsoftversion / power(2, 24) = 9)
          AND (@@microsoftversion & 0xffff >= 3024))
         OR ((@@microsoftversion / power(2, 24) = 10)
             AND (@@microsoftversion & 0xffff >= 1600))))
    SELECT @VarDecimalSupported = 1;

IF (@VarDecimalSupported > 0)
    BEGIN
        EXECUTE sp_db_vardecimal_storage_format N'$(DatabaseName)', 'ON';
    END


GO
PRINT N'Update complete.';


GO
